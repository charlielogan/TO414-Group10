---
title: "hotels"
author: "Charlie Logan"
date: "2/10/2021"
output: html_document
---

Charlie Logan, Jonathan Demeter, Ana Mohapatra, Nikita Mehendale, Srishti Senthil
 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
hotels <- read.csv("hotel_bookings.csv")
```

## Data Cleaning
```{r}
hotels$arrival_date_year = as.factor(hotels$arrival_date_year)
hotels$arrival_date_month = as.factor(hotels$arrival_date_month)
hotels$arrival_date_week_number = as.factor(hotels$arrival_date_week_number)
hotels$arrival_date_day_of_month = as.factor(hotels$arrival_date_day_of_month)
hotels$company = as.factor(hotels$company)
summary(hotels)
                          
```
## Data exploration
```{r}
barplot(sort(table(hotels$arrival_date_month)), las=2)
```
January is the least common month, August the most

```{r}
hotels$hotel <- as.factor(hotels$hotel)
canceledbyhotel <- tapply(hotels$is_canceled, hotels$hotel, mean, na.rm=TRUE)
canceledbyhotel
```
City hotel has a higher cancellation rate
```{r}
hotels$has_children <- hotels$children > 0 | hotels$babies > 0
canceledbychilden <- aggregate(is_canceled ~ has_children, data = hotels, mean)
canceledbychilden
```
```{r}
hotels$has_baby <- hotels$babies > 0
(canceledbybaby<- aggregate(is_canceled ~ has_baby, data = hotels, mean))
```

simple questions to answer: 
1.) What country has the most amount of cancellation?
2.) What month has the most amount of cancellations?
3.) What market segments have the highest cancellations?
4.) What market segment travels most in a given month?
What day of the month has the most ...? 
Does having children make cancellations more likely?
Which hotel has the higher cancellation?
Do deposits make it less likely for someone to cancel?
Is staying a fewer numbers of days more likely to be canceled then staying a week?

```{r}
library(tidyverse)
hotel_bookings1 <- hotel_bookings %>% mutate(arrival_date_year = as.factor(arrival_date_year),
                                             arrival_date_month = as.factor(arrival_date_month),
                                             arrival_date_week_number = as.factor(arrival_date_week_number),
                                             arrival_date_day_of_month = as.factor(arrival_date_day_of_month),
                                             #stays_in_weekend_nights = as.factor(stays_in_weekend_nights),
                                             adults = as.factor(adults),
                                             #children = as.factor(children),
                                             babies = as.factor(babies),
                                             previous_cancellations = as.factor(previous_cancellations),
                                             previous_bookings_not_canceled = as.factor(previous_bookings_not_canceled),
                                             booking_changes = as.factor(booking_changes),
                                             required_car_parking_spaces = as.factor(required_car_parking_spaces),
                                             total_of_special_requests = as.factor(total_of_special_requests))
```


1.)
```{r}
hotel_bookings1 %>% group_by(country) %>% summarise(num_cancel = sum(is_canceled)) %>% arrange(desc(num_cancel)) %>% head(10) %>% print %>% ggplot(aes(x = country, y = num_cancel, fill= num_cancel))+ geom_col()

```

2.)
```{r}
hotel_bookings1 %>% group_by(arrival_date_month) %>% summarise(num_cancel = sum(is_canceled)) %>% arrange(desc(num_cancel)) %>% head(10) %>% print %>% ggplot(aes(x = arrival_date_month, y = num_cancel, fill= num_cancel))+ geom_col()
```
3.)
```{r}
hotel_bookings1 %>% group_by(market_segment) %>% summarise(num_cancel = sum(is_canceled)) %>% arrange(desc(num_cancel)) %>% head(10) %>% print %>% ggplot(aes(x = market_segment, y = num_cancel, fill= num_cancel))+ geom_col()
```
4.) What market segment travels most in a given month? *maybe look at percentage?
```{r}
hotel_bookings1 %>% group_by(market_segment) %>% count %>% print %>%
          ggplot(aes(x = market_segment, y = n, fill= n))+ geom_col()
```
Is staying a fewer numbers of days more likely to be canceled then staying a week? *add in proportions
```{r}
hotel_bookings1 %>% select(is_canceled, stays_in_weekend_nights, stays_in_week_nights) %>% 
                    mutate(days_stayed = stays_in_weekend_nights + stays_in_week_nights,
                           week_stay = ifelse(days_stayed >= 7, 1, 0)) %>%
                    group_by(week_stay) %>% summarize(num_cancel = sum(is_canceled))


hotel_bookings1 %>% select(is_canceled, stays_in_weekend_nights, stays_in_week_nights) %>% 
                    mutate(days_stayed = stays_in_weekend_nights + stays_in_week_nights,
                           week_stay = ifelse(days_stayed >= 7, 1, 0)) %>%
                    group_by(week_stay) %>% summarize(num_cancel = mean(is_canceled))
```

Are guests staying only during the week more likely to cancel than guest staying only during the weekend?
*Does the data seem to have issues that we need to check?
```{r}
hotel_bookings1 %>% select(is_canceled, stays_in_weekend_nights, stays_in_week_nights, reservation_status) %>%
                    filter(stays_in_weekend_nights == 0) %>% head
                    
```
Do deposits make it less likely for someone to cancel?
```{r}
hotel_bookings1 %>% select(is_canceled, deposit_type) %>% group_by(deposit_type) %>% summarise(num_cancel = sum(is_canceled))


hotel_bookings1 %>% select(is_canceled, deposit_type) %>% group_by(deposit_type) %>% count

hotel_bookings1 %>% select(is_canceled, deposit_type) %>% group_by(deposit_type) %>% summarise(num_cancel = mean(is_canceled))

```

Does having children make cancellations more likely? *note that there may be more cancellations in guests with no children due to guests with no children be larger in general.
```{r}
unique(hotel_bookings1$children)
hotel_bookings1 %>% select(is_canceled, children) %>% na.omit(children) %>%
                   mutate(has_child = ifelse(children != 0, 1, 0)) %>%
                    group_by(has_child) %>% summarise(num_cancel = sum(is_canceled))
```


